var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=14)}({14:function(e,t,i){"use strict";var o;function n(e){if(void 0===e)throw new TypeError("SessionInitParams");if(void 0===e.hostSessionId)throw new TypeError("HostSessionId")}function s(e){if(void 0===e)throw new TypeError("SessionBootParams");var t=e.applicationUrl,i=e.applicationBaseUrl;if(void 0===t&&void 0===i)throw new TypeError("Either applicationUrl or applicationBaseUrl should exist");if(void 0!==t&&"string"!=typeof t)throw new TypeError("ApplicationUrl");if(void 0!==i&&"string"!=typeof i)throw new TypeError("ApplicationBaseUrl");var o=e.file;if(void 0===o||void 0===o.name)throw new TypeError("FileInfo");var n=e.containerElement;if(void 0===n||void 0===n||void 0===n.appendChild)throw new TypeError("ContainerElement");var s=e.wopi;if(void 0===s||void 0===s.source||void 0===s.accessToken||void 0===s.expiry)throw new TypeError("WopiInfo")}i.r(t),function(e){e.boot="boot",e.dispose="dispose",e.postMessage="postMessage"}(o||(o={}));var r,a,c=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();!function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(r||(r={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout"}(a||(a={}));var p;(function(){function e(){}e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,i,o){return"tag_"+e.tagIntToString(t)+" ["+a[i]+"] "+o},e.prototype.sendTraceTag=function(t,i,o,n){var s=console.log;switch(o){case r.Error:s=console.error;break;case r.Warning:s=console.warn;break;case r.Info:s=console.info;break;case r.Verbose:s=console.debug;break;case r.Spam:default:s=console.log}try{s(e.getLogMessage(t,i,n))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,i,o,n){console.assert(o,e.getLogMessage(t,i,n))},e.prototype.debugAssertTag=function(e,t,i,o){this.shipAssertTag(e,t,i,o)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function e(){this.externalLogger=new c}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,i,o){this.externalLogger.sendTraceTag(e,t,i,o)},e.prototype.debugAssertTag=function(e,t,i,o){this.externalLogger.debugAssertTag(e,t,i,o)},e.prototype.shipAssertTag=function(e,t,i,o){this.externalLogger.shipAssertTag(e,t,i,o)},e}());function l(e,t,i){if(""!==t){var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,i),o.send(e))}}function d(e,t,i,o){var n=e.map((function(e){return function(e,t){var i={};i.G=e.tag,i.T=e.timestamp-t,i.M=e.message,i.C=e.category;var o=1e3*e.type+e.level;return i.D=o,i}(e,o)})),s=function(e,t,i,o){var n={};return n.T=e,n.L=t,n.S=i,n.I=o,n.V=1,n}(o,n,t,i);return JSON.stringify(s)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(p||(p={}));!function(){function e(t,i){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,i){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,l(d(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,i),o.logCache=[],o.timestampBase=Date.now());t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=i+"?usid="+t,window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)}e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===r.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]"}();r.Info;

var g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function u(e,t){function i(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var f=function(){return(f=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var h,m;!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}u(t,e)}(c);function S(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))}function w(e,t){return{isFeatureEnabled:function(i){return function(e,t,i){if(!t)return;try{return t(e)}catch(e){i&&i.ULS.traceTag(594883024,a.msoulscat_Wac_WopiPendingApplication,r.Error,"Host encountered error in featuremanager callback: "+S(e))}return}(i,e,t)}}}!function(e){e.AccessibilityLoopCompleted="AccessibilityLoopCompleted",e.BootCompleted="BootCompleted",e.BrowserEvent="BrowserEvent",e.Conversation="Conversation",e.CopyAndEdit="CopyAndEdit",e.Disposed="Disposed",e.Download="Download",e.Error="Error",e.FileEmbed="FileEmbed",e.FileProperties="FileProperties",e.FileRenamed="FileRenamed",e.FileRenameFailed="FileRenameFailed",e.FileVersions="FileVersions",e.FrameStateChanged="FrameStateChanged",e.GetWopiInfoFromUrl="GetWopiInfoFromUrl",e.ModeSwitched="ModeSwitched",e.OpenInBrowser="OpenInBrowser",e.OpenInClient="OpenInClient",e.PageChanged="PageChanged",e.Reboot="Reboot",e.RedeemForCommenting="RedeemForCommenting",e.RefreshSessionInfo="RefreshSessionInfo",e.ReplyWithChanges="ReplyWithChanges",e.ReportAbuse="ReportAbuse",e.SaveStatus="SaveStatus",e.Share="Share",e.ShareForm="ShareForm",e.SessionCreated="SessionCreated",e.SignIn="SignIn",e.UserAccessAndPermissions="UserAccessAndPermissions",e.UserActivity="UserActivity",e.UserEditActivity="UserEditActivity",e.ZoomChanged="ZoomChanged"}(h||(h={})),function(e){e.Unknown="UNKNOWN",e.Initialized="INITIALIZED",e.Prebooted="PREBOOTED",e.Booting="BOOTING",e.Booted="BOOTED",e.Failed="FAILED",e.Disposing="DISPOSING",e.Disposed="DISPOSED"}(m||(m={}));var v=function(){function e(e,t){var i=this;this.messageMaxChars=3072,this.trimmedMessage="... [Trimmed]",this.fastUploadCadenceInMsSec=1e3,this.uploadCadenceInMsSec=3e4,this.uploadTriggerSize=30,this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){i.triggerUpload(!1,!1)},this.flush=function(){i.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return i.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(e,t){if(window.clearTimeout(i.timeoutId),i.remoteUrlEndpoint){if(i.logCache.length>0)i.uploadId+=1,l(d(i.logCache.splice(0,e?i.uploadTriggerSize:i.logCache.length),i.userSessionId,i.uploadId,i.timestampBase),i.remoteUrlEndpoint,t),i.timestampBase=Date.now();e&&(i.timeoutId=window.setTimeout(i.triggerUploadAsync,i.logCache.length>i.uploadTriggerSize?i.fastUploadCadenceInMsSec:i.uploadCadenceInMsSec))}},this.userSessionId=e,t&&this.configure(t)}return e.prototype.configure=function(e){var t=this;if(e.uploadCadenceInMsSec&&(this.uploadCadenceInMsSec=e.uploadCadenceInMsSec),e.uploadTriggerSize&&(this.uploadTriggerSize=e.uploadTriggerSize),e.remoteUlsEndpoint){if(this.remoteUrlEndpoint)throw new Error("Remote ULS endpoint is already set");this.remoteUrlEndpoint=e.remoteUlsEndpoint+"?usid="+this.userSessionId,this.timestampBase=Date.now(),window.setTimeout((function(){return t.triggerUpload(!0,!0)}),0)}},e.prototype.handleTrace=function(e){e.message.length>this.messageMaxChars&&(e.message=e.message.substr(0,this.messageMaxChars-this.trimmedMessage.length)+this.trimmedMessage),this.logCache.push(e),(this.logCache.length>this.uploadTriggerSize||e.level===r.Error)&&this.triggerUploadAsync()},e}();function I(e,t){var i=new v(e,t);function o(e,t,o,n){var s={timestamp:Date.now(),category:t,tag:e,level:o,type:p.Trace,message:n};i.handleTrace(s)}return{ULS:{sendTraceTag:function(e,t,i,n){o(e,t,i,n)},shipAssertTag:function(e,t,i,n){i&&o(e,t,r.Error,n)},debugAssertTag:function(e,t,i,o){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose},configure:function(e){i.configure(e)}}}function y(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+S(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+S(e))}for(var s=0;s<e.length;s+=1){try{if(o){t.perfNow=!0;var r=Math.floor(100*n.now())%10;(r<0||r>9)&&(r=0);for(var a=0;a<r;a+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+S(e))}e[s]=Math.floor(16*Math.random())}return t}(e),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=15&e[i];return i+=1,("x"===t?o:3&o|8).toString(16)})),t]}var T,A,F,P,W,C=function(){function e(e,t,i,o){this.applicationPathUrl="",this.appUrl="";var n=y(),s=n[0],c=n[1];this.logger=I(s),this.logger.ULS.sendTraceTag(595937313,a.msoulscat_Wac_WopiPendingApplication,r.Info,JSON.stringify(c)),this.state=m.Unknown,this.sessionId=s,this.hostSessionId=t.hostSessionId,this.host=e.host,this.user=e.user,this.bootstrapperUrl=e.bootstrapperUrl,this.hostSupport=e.hostSupport,this.uiSettings=e.uiSettings,this.viewModeSettings=e.viewModeSettings,this.featureManager=i,this.sessionEventHandler=o}return e.prototype.raiseEvent=function(e,t){try{this.sessionEventHandler(e,t)}catch(e){this.logger.ULS.sendTraceTag(594556387,a.msoulscat_Wac_WopiPendingApplication,r.Error,"Handler error: "+S(e))}},e}();!function(e){e.blurFocus="blurFocus",e.boot="boot",e.continueAccessibilityLoop="continueAccessibilityLoop",e.dispose="dispose",e.grabFocus="grabFocus",e.rename="rename",e.sendEmbeddedViewUrl="sendEmbeddedViewUrl",e.sendSessionInfo="sendSessionInfo",e.sendUserAccessAndPermissions="sendUserAccessAndPermissions",e.sendWopiInfo="sendWopiInfo",e.switchMode="switchMode"}(T||(T={})),function(e){e.AccessibilityLoopCompleted="App_AccessibilityLoopComplete",e.BootFailed="Wac_AppFailed",e.BootState="Wac_AppBootState",e.BootSucceeded="Wac_AppCompleted",e.BrowserEvent="BrowserEvent",e.Close="UI_Close",e.Conversation="UI_Conversation",e.CopyAndEdit="UI_CopyAndEdit",e.Download="UI_Download",e.Error="Error",e.FileEmbed="UI_FileEmbed",e.FileProperties="UI_FileProperties",e.FileRenamed="File_Rename",e.FileRenameFailed="File_RenameFailed",e.FileVersions="UI_FileVersions",e.FrameStateChanged="StateChanged",e.TrustFrame="App_IsFrameTrusted",e.GetWopiInfoFromUrl="App_WopiInfoFromUrl",e.InitFrameLoaded="WacInitialize_FrameLoaded",e.InitReady="WacInitialize_Ready",e.LoadingStatus="App_LoadingStatus",e.ModeSwitched="App_SwitchMode",e.OpenInBrower="UI_OpenInBrowser",e.OpenInClient="UI_OpenInClient",e.PageChanged="PageChanged",e.PushState="App_PushState",e.Reboot="App_DocReboot",e.RedeemForCommenting="UI_RedeemForCommenting",e.RefreshSessionInfo="App_RefreshSessionInfo",e.ReplyWithChanges="UI_ReplyWithChanges",e.ReportAbuse="UI_ReportAbuse",e.SaveStatus="UI_SaveStatus",e.SessionCompleteAck="WopiSession_Complete_Ack",e.Share="UI_Sharing",e.ShareForm="UI_ShareForm",e.SignIn="UI_SignIn",e.SoftReboot="App_SoftReboot",e.Unloaded="App_Unloaded",e.UpdatePageCount="PageCount",e.UserAccessAndPermissions="UI_CheckUserAccessAndGrantPermissions",e.UserActivity="User_Activity",e.UserEditActivity="Edit_Notification",e.Workflow="UI_Workflow",e.ZoomChanged="ZoomChanged"}(A||(A={})),function(e){e.Ack="Ack",e.BlurFocus="Blur_Focus",e.BootFailedAck="Wac_AppFailed_Ack",e.BootSucceededAck="Wac_AppCompleted_Ack",e.ContinueAccessibilityLoop="Host_AccessibilityLoopComplete",e.FailSession="WopiPendingSession_Fail",e.TrustFrame="Host_IsFrameTrusted",e.GrabFocus="Grab_Focus",e.HostCacheDiagnostic="HostCacheDiagnostic",e.InitReadyAck="WacInitialize_Ready_Ack",e.JsApiDiagnostics="JsApiDiagnostics",e.PageChangedAck="PageChanged_Ack",e.PendingAppCompleteReceived="WopiPendingApplicationComplete_Received",e.PendingSessionComplete="WopiPendingSession_Complete",e.PopState="App_PopState",e.PostmessageReady="Host_PostmessageReady",e.Rename="File_Rename",e.SendEmbeddedViewUrl="CanEmbed",e.SendSessionInfo="Host_RefreshSessionInfo",e.SendUserAccessAndPermissions="CheckUserAccessAndGrantPermissions_Result",e.SendWopiInfo="Host_WopiInfoFromUrl",e.SetCurrentPage="SetCurrentPage",e.SetZoomLevel="SetZoomLevel",e.StartSessionComplete="WopiStartSession_Complete",e.SwitchMode="Host_SwitchMode",e.Unload="Host_Unload",e.UpdatePageCountAck="PageCount_Ack",e.ZoomChangedAck="ZoomChanged_Ack"}(F||(F={}));var U=((P={})[T.blurFocus]=o.postMessage,P[T.boot]=o.boot,P[T.continueAccessibilityLoop]=o.postMessage,P[T.dispose]=o.dispose,P[T.grabFocus]=o.postMessage,P[T.rename]=o.postMessage,P[T.sendEmbeddedViewUrl]=o.postMessage,P[T.sendSessionInfo]=o.postMessage,P[T.sendUserAccessAndPermissions]=o.postMessage,P[T.sendWopiInfo]=o.postMessage,P[T.switchMode]=o.postMessage,P),b=((W={})[T.blurFocus]=F.BlurFocus,W[T.continueAccessibilityLoop]=F.ContinueAccessibilityLoop,W[T.grabFocus]=F.GrabFocus,W[T.rename]=F.Rename,W[T.sendEmbeddedViewUrl]=F.SendEmbeddedViewUrl,W[T.sendSessionInfo]=F.SendSessionInfo,W[T.sendUserAccessAndPermissions]=F.SendUserAccessAndPermissions,W[T.sendWopiInfo]=F.SendWopiInfo,W[T.switchMode]=F.SwitchMode,W);function E(e){return 8===e.toLowerCase().indexOf("ffc")}function O(e){return 8===e.toLowerCase().indexOf("ppc")}function M(e){var t=e.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function R(e,t){var i=e.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");var o=i[2];if(void 0===t)return o;if(t<0)throw new Error("subDomainParts should be at least 1");return o.split(".").slice(-(t+1)).join(".")}function L(e){var t=e.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}var x=function(){function e(e,t,i,o,n,s){var r=this;this.context=new C(e,t,i,(function(e,t){return o(e,r,t)})),this.application=n,this.flows=s();var a={session:this};this.context.raiseEvent(h.SessionCreated,a),this.context.state=m.Initialized}return e.prototype.getSessionId=function(){return this.context.sessionId},e.prototype.getDiagnostics=function(){return f(f({},this.context.hostInitDiagnostics),this.context.appInitDiagnostics)},e.prototype.run=function(e,t,i){var o=[],n=U[e],s=this.flows[n];return o.push(s(e,this.context,t,i)),i&&o.push(new Promise((function(e){window.setTimeout((function(){e({success:!1,error:"timeout"})}),i)}))),Promise.race(o)},e.prototype.boot=function(e,t){var i=this;return s(e),this.context.appUrl=e.applicationUrl?e.applicationUrl:e.applicationBaseUrl,this.context.applicationPathUrl=L(this.context.appUrl),this.context.logger.configure({remoteUlsEndpoint:this.context.applicationPathUrl+"RemoteUls.ashx"}),this.context.applicationUrl=e.applicationUrl,this.context.applicationBaseUrl=e.applicationBaseUrl,this.context.intent=e.intent,this.context.file=e.file,this.context.wopi=e.wopi,this.context.contentBundle=e.contentBundle,this.context.bootParams=e.bootParams,this.context.sessionContext=e.sessionContext,this.context.activityNavigationId=e.activityNavigationId,this.context.wdParams=e.wdParams,this.context.preseededSessionKey=e.preseededSessionKey,this.context.preseededWacSessionId=e.preseededWacSessionId,this.context.hostInitDiagnostics=e.diagnostics,this.context.appInitDiagnostics={},this.context.state=m.Booting,this.run(T.boot,e,t).then((function(e){var t={completion:e.success?"success":"timeout"===e.error?"timeout":"failure"};return i.context.raiseEvent(h.BootCompleted,t),i.context.state=e.success?m.Booted:m.Failed,e}))},e.prototype.dispose=function(e){var t=this;return this.context.state=m.Disposing,this.run(T.dispose,void 0,e).then((function(e){var i={completion:e.success?"success":"timeout"===e.error?"timeout":"failure"};return t.context.raiseEvent(h.Disposed,i),t.context.state=m.Disposed,e}))},e}(),_= "16.0.12801.37951";function D(){return _}var H,k;!function(){function e(e,t,i){var o=this;this.eventHandlers=[],this.sessions=[],this.containers=[],this.removeSessionOnDisposed=function(e,t){if(e===h.Disposed){var i=o.sessions.indexOf(t);i>-1&&o.sessions.splice(i,1)}},this.dispatchEvent=function(e,t,i){o.eventHandlers.forEach((function(o){return o(e,t,i)}))},function(e){if(void 0===e)throw new TypeError("ApplicationInitParams");var t=e.host;if(void 0===t||void 0===t.storageHostName)throw new TypeError("HostInfo");var i=e.user;if(void 0===i||void 0===i.id)throw new TypeError("UserInfo")}(e),this.applicationInitParams=e,this.applicationName=t,this.flowFactory=i,this.featureManager=w(e.hostSupport&&e.hostSupport.isFeatureEnabledCallback),this.addEventHandler(this.removeSessionOnDisposed)}e.prototype.getApplicationName=function(){return this.applicationName},e.prototype.getVersion=function(){return D()},e.prototype.prefetch=function(){throw new Error("Not implemented")},e.prototype.addEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.removeEventHandler=function(e){var t=this.eventHandlers.indexOf(e);t>-1&&this.eventHandlers.splice(t,1)},e.prototype.createSession=function(e){n(e);var t=new x(this.applicationInitParams,e,this.featureManager,this.dispatchEvent,this,this.flowFactory);return this.sessions.push(t),t},e.prototype.bootDocument=function(e,t){return function(e){if(void 0===e)throw new TypeError("DocumentBootParams");n(e),s(e)}(e),this.createSession(e).boot(e,t)},e.prototype.dispose=function(e){var t=this.sessions.map((function(t){return t.dispose(e).then((function(e){return e.success||(e.error="Failed, sessionId: "+t.getSessionId()),e})).catch((function(e){return{success:!1,error:"Failed, sessionId: "+t.getSessionId()}}))}));return Promise.all(t).then((function(e){var t={success:!0},i=[];return e.forEach((function(e){e.success||(t.success=!1,e.error&&i.push(e.error+";"))})),t.error=i.join(" "),t}))}}();!function(e){e.H2StaticContent="H2StaticContent",e.InstantShell="InstantShell",e.EnterpriseTemplates="EnterpriseTemplates",e.HashedUrl="HashedUrl",e.ExcelAdaptiveLayoutDownload="ExcelAdaptiveLayoutDownload",e.ExcelLandingPageObserverRetry="ExcelLandingPageObserverRetry",e.OfficeComUiHost="OfficeComUiHost"}(H||(H={})),function(e){e.Unknown="Unknown",e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.CannotLoadScript="CannotLoadScript",e.PageChangeError="PageChangeError",e.ZoomChangeError="ZoomChangeError",e.CannotLoadBundleItem="CannotLoadBundleItem",e.InvalidPageIndex="InvalidPageIndex",e.UnsupportedBundleVersion="UnsupportedBundleVersion",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(k||(k={}));var B,N,z={ExcelEwaJs:a.msoulscat_ES_EWAJS,WordViewer:a.msoulscat_Wac_WordViewer,WopiPendingApplication:a.msoulscat_Wac_WopiPendingApplication,VisioApp:a.msoulscat_Wac_VisioApp,PptSession:a.msoulscat_Wac_PptSession};function V(e,t){var i=e.indexOf("&"+t+"=");if(-1===i&&(i=e.indexOf("?"+t+"=")),-1===i)return"";var o=i+(t.length+2),n=e.indexOf("&",o);return-1===n?e.substr(o):e.substring(o,n)}function J(e,t,i,o){if(void 0===o&&(o=!1),!i)return e;var n=e,s=n.indexOf("?"),r="&";s===n.length-1||"&"===n.slice(-1)||"&>"===n.slice(-2)?r="":-1===s&&(r="?");var a=t.toLowerCase()+"=",c=n.toLowerCase().indexOf(a,s);if("?"!==r&&c>=0){if(o){var p=n.indexOf("&",c);n=n.substring(0,c)+a+i+(-1===p?"":n.substring(p))}return n}return n.concat(r,a,i)}function j(e){if(null==e)return"";var t=-1===e.indexOf("#")?e.length:e.indexOf("#"),i=e.lastIndexOf("/",t);if(-1!==i&&i+1===e.indexOf("://")+"://".length)return"";i+=1;var o=e.indexOf("?");if(-1!==(o=o>=t?-1:o)&&i>o)return"";var n=-1===o?t:o;return i>=n?"":e.substring(i,n)}function G(e,t){t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((function(i){return e[i]=t.Diagnostics[i]}))}function q(){if(window&&window.navigator){var e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection,i={};return t&&(i.netEffectiveType=t.effectiveType,i.netDownlink=t.downlink,i.netType=t.type,i.netDownlinkMax=t.downlinkMax,i.netRtt=t.rtt,i.netSaveData=t.saveData),i.deviceMemory=e.deviceMemory,i.logicalProcessors=e.hardwareConcurrency,i}}function Z(e,t,i){t.ULS.traceTag(596459999,z.WopiPendingApplication,i,"SessionTraces: "+JSON.stringify(e))}function K(e,t,i){i.Stop();var o=i.GetVisibilityChangeEvents();null!=o&&o.length>0&&(e.documentLoadedWithTabSwitch=!0,t.tabSwitchDiagnostics=JSON.stringify(o)),i.Dispose()}function X(e){try{if(void 0===window.performance)return void e.ULS.traceTag(595948609,z.WopiPendingApplication,r.Info,"Performance not supported");var t=window.performance.getEntriesByType("resource");if(void 0===t||t.length<=0)return void e.ULS.traceTag(595948610,z.WopiPendingApplication,r.Info,"No resources under performance");for(var i=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js|onenote-boot.js","i"),o=0,n=t;o<n.length;o++){var s=n[o];if(i.test(s.name)){var a=JSON.stringify(s),c=j(s.name);return a=a.replace(new RegExp(s.name,"g"),c),void e.ULS.traceTag(595948616,z.WopiPendingApplication,r.Info,a)}}e.ULS.traceTag(595948484,z.WopiPendingApplication,r.Info,"Could not find JSAPI resource timing entry")}catch(t){e.ULS.traceTag(595948617,z.WopiPendingApplication,r.Info,"Could not trace the resource timing: "+S(t))}}function $(e,t,i){if(e){var o="Page lifecycle: "+t+" fired.";o+=i?" Flushing ULS logger":"",e.ULS.traceTag(595957843,z.WopiPendingApplication,r.Info,o),i&&e.ULS.flush()}}function Q(e,t,i){e.ULS.traceTag(596464283,z.WopiPendingApplication,r.Info,"Initializing session. Build version: "+D()),i&&e.ULS.traceTag(595937313,z.WopiPendingApplication,r.Info,JSON.stringify(i)),t.rebootOverrideData&&(t.rebootOverrideData.previousSessionId||e.ULS.traceTag(594613645,z.WopiPendingApplication,r.Warning,"Missing previous session id")),e.ULS.traceTag(595632928,z.WopiPendingApplication,r.Info,function(){if(window&&window.navigator){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(e)return"EffectiveType: "+e.effectiveType+", BandwidthMps: "+e.downlink+", ConnectionType: "+e.type}return""}()),t&&t.wopiInfo&&t.wopiInfo.AccessToken&&t.wopiInfo.AccessTokenExpiry?(0===t.wopiInfo.AccessToken.length||t.wopiInfo.AccessTokenExpiry.getTime()<=Date.now())&&e.ULS.traceTag(595894621,z.WopiPendingApplication,r.Error,"Invalid AccessToken. AccessTokenLength: "+t.wopiInfo.AccessToken.length+", AccessTokenExpiry: "+t.wopiInfo.AccessTokenExpiry+", AccessTokenTTL: "+t.wopiInfo.AccessTokenExpiry.getTime()+", DateNow: "+Date.now()):e.ULS.traceTag(595894553,z.WopiPendingApplication,r.Warning,"There are some missing paramters");var o=function(e,t){var i=JSON.parse(JSON.stringify(t));delete i.UserId,delete i.OwnerId,delete i.WdParams;var o=t.WdParams?JSON.parse(JSON.stringify(t.WdParams).toLowerCase()):{};return i.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){o[e]&&(i.WdParams[e]=o[e])})),i.UiEmbedMode=e.toLowerCase().indexOf("uiembed=1")>=0,i.UiHostName=V(e,"uih")||"N/A",i.hostName=location?location.hostname:"",i}(t.applicationUrl,t.sessionInformation);e.ULS.traceTag(596444237,z.WopiPendingApplication,r.Info,JSON.stringify({hostSessionInformation:o,clientSignals:q()})),e.ULS.traceTag(596444238,z.WopiPendingApplication,r.Info,"HostInitDiagnostics: "+(t.diagnostics.HostInitializeDiagnostics?JSON.stringify(t.diagnostics.HostInitializeDiagnostics):"N/A"))}function Y(){if(null!=navigator&&null!=navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return B.Firefox;if(e.indexOf("Opera")>-1)return B.Opera;if(e.indexOf("Trident")>-1)return B.IE;if(e.indexOf("Edge")>-1)return B.Edge;if(e.indexOf("Chrome")>-1)return B.Chrome;if(e.indexOf("Safari")>-1)return B.Safari}return B.Unknown}function ee(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Macintosh")>=0&&ie()&&!(navigator.userAgent.indexOf("iPhone")>=0)||navigator.userAgent.indexOf("Android")>=0||ie()}catch(e){return!1}}function te(){return Y()===B.IE&&!function(){if(Y()!==B.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function ie(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}!function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.Unknown=6]="Unknown"}(B||(B={})),function(e){e.bootWithoutWopiInfo="",e.unifiedSingleFlush="Unified_SingleFlush",e.unifiedIrmEnabled="Unified_IrmEnabled",e.unifiedViewActionUrl="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",e.forceSingleStepBoot="Force_SingleStepBoot",e.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",e.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect"}(N||(N={}));var oe,ne,se,re=!1,ae=!1;function ce(){re=!1}function pe(e,t,i,o,n,s){if(t.ULS.traceTag(595714433,z.WopiPendingApplication,r.Info,"Starting disposing the application. unloadApp:"+e+"; disposed:"+re+"; unloading:"+ae),re||ae&&e)t.ULS.traceTag(595714908,z.WopiPendingApplication,r.Info,"Application is already disposed or unloading");else{var a,c={logger:t,postMessenger:i,innerApplicationFrame:o,onDisposed:n,unloadTimeoutInMs:s||Oe,forceAppUnload:!1,disposeStartTime:Date.now(),appUnloadTimedOut:!1};if(e&&o)return ae=!0,c.forceAppUnload=!0,(a=c).forceAppUnloadStartTime=Date.now(),a.logger.ULS.traceTag(595855490,z.WopiPendingApplication,r.Info,"Sending postmessage to unload app"),a.logger.ULS.flush(),a.postMessenger.registerMessagePayloadHandler(A.Unloaded,(function(e){return function(e,t){e.forceAppUnloadEndTime=Date.now(),e.appUnloadedMessageValues=t,e.logger.ULS.traceTag(595855491,z.WopiPendingApplication,r.Info,"AppUnloaded received from app"),le(e)}(a,e)})),a.postMessenger.sendPostMessage(a.innerApplicationFrame.contentWindow,F.Unload,{}),void window.setTimeout((function(){return function(e){!ae&&re||(e.appUnloadTimedOut=!0,e.logger.ULS.traceTag(595855492,z.WopiPendingApplication,r.Info,"ApplicationUnload timed out, forcing dispose"),le(e))}(a)}),a.unloadTimeoutInMs);le(c)}}function le(e){if(!re)try{re=!0,ae=!1,function(e){if(!e.innerApplicationFrame)return;e.innerApplicationFrame.src="about:blank",window.setTimeout((function(){e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame)}),0)}(e),function(e){var t={disposeStartTime:e.disposeStartTime,disposeEndTime:Date.now(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};e.forceAppUnloadStartTime&&(t.appUnloadStartTime=e.forceAppUnloadStartTime);e.forceAppUnloadEndTime&&(t.appUnloadEndTime=e.forceAppUnloadEndTime);if(e.appUnloadedMessageValues){var i=e.appUnloadedMessageValues;void 0!==i.sendBeaconFlight&&(t.sendBeaconFlight=i.sendBeaconFlight),void 0!==i.sendBeaconSupported&&(t.sendBeaconSupported=i.sendBeaconSupported);var o=Number(i.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(o)&&(t.hostToAppPostMessageLatency=o-e.forceAppUnloadStartTime);var n=Number(i.appMessageSent);!isNaN(n)&&e.forceAppUnloadEndTime&&(t.appToHostPostMessageLatency=e.forceAppUnloadEndTime-n);var s=Number(i.appUnloadStart),a=Number(i.appUnloadEnd);if(isNaN(s)||isNaN(a)||(t.appUnloadLatency=a-s),i.serverTimings){var c=i.serverTimings;for(var p in c)t["st-"+p.toString()]=c[p]}}e.logger.ULS.traceTag(595855436,z.WopiPendingApplication,r.Info,"App disposed "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(t){e.logger.ULS.traceTag(595714434,z.WopiPendingApplication,r.Error,"Error disposing: "+S(t))}}var de;function ge(e,t){oe||(oe=function(){var e=function(){0;var e=window.ExcelSettings;return he(e)?e:void 0}(),t=function(){try{if(!window||!window.localStorage||!window.localStorage.getItem("ExcelSettings"))return;var e=window.localStorage.getItem("ExcelSettings"),t=JSON.parse(e);return he(t)?t:void 0}catch(e){return void(se&&se.ULS.traceTag(595616212,z.WopiPendingApplication,r.Error,"Failed to get settings from localStorage: "+S(e)))}}();if(e&&t)return parseInt(e.timestamp,10)>parseInt(t.timestamp,10)?e:t;return t||e}()),!se&&t&&(se=t),e&&!ne&&(ne=setTimeout(fe,3e4,e))}function ue(e,t){if(ge(),!oe||!oe.hasOwnProperty(e))return t;var i=oe[e],o=typeof t;if(typeof i===o)return i;if("string"==typeof i){if("number"===o)return parseInt(i,10);if("boolean"===o)return"true"===i}return t}function fe(e){if(re)return clearTimeout(ne),void(ne=void 0);var t=new XMLHttpRequest;t.open("GET",e+"AppSettingsHandler.ashx?app=Excel"),t.responseType="json",t.timeout=5e3,t.send(),t.onload=function(){200===t.status&&t.response&&(!function(e){if(!he(e))return;if(oe=e,!window||!window.localStorage)return;var t=JSON.stringify(e);try{window.localStorage.setItem("ExcelSettings",t)}catch(e){se&&se.ULS.traceTag(595616214,z.WopiPendingApplication,r.Error,"Failed to set localStorage: "+S(e))}}(t.response),ne=setTimeout(fe,ue(de.SettingsFetchPeriod,6e4),e))}}function he(e){if(e&&"object"==typeof e){if(e.hasOwnProperty("timestamp")&&!isNaN(e.timestamp))return!0;se&&se.ULS.traceTag(595616215,z.WopiPendingApplication,r.Error,"Received invalid settings")}return!1}function me(e,t,i){void 0===i&&(i=!1);var o=e.applicationUrl;e.wopiPrecheckInfo.IsNewFile&&o.replace("unified=1","edit=1&new=1");var n={jsApi:"1"};if(i&&(n.NewSession="1"),n.corrid=e.sessionId,n.usid=e.sessionId,(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(n.core="1"),e.sessionInformation.HideViewerToolbar&&(n.hvt="1"),e.sessionInformation.DisableFocusOnBoot&&(n.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(n.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAccessibilityLoop&&(n.accloop="1"),e.sessionInformation.SupportsDocReboot){var s=e.sessionInformation.SupportsDocReboot;n.sdr=!0===s?"1":s.toString()}return e.sessionInformation.SupportsCreateNewDocument&&(n.scnd="1"),e.sessionInformation.HideHeader&&(n.hhdr="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(n.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(n.readOnly="1"),e.sessionInformation.UIEmbed&&(n.uiEmbed="1"),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(n.InAppDocPreview="1"),t.isSingleStepBoot?(t.bootFlowType===N.unifiedSingleFlush&&(e.isCreateNew||(n.instantedit="1",n.wopicomplete="1")),n.wdRedirectionReason=t.bootFlowType):(n.instantedit="1",n.fileSrc=encodeURIComponent(e.sessionInformation.HostName),n.pmOrigin=encodeURIComponent(M(window.location.href)),e.isCreateNew&&(n.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(n.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(n.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(n.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),function(e){var t=e.featureManager&&e.featureManager.isFeatureEnabled(H.InstantShell),i=e.applicationUrl;return(E(i)||O(i))&&ue(de.ExcelInstantShellEnabled,!1)||t;return!1}(e)&&(n.instantshell="1"),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(n=f(f({},e.applicationCustomSettings.additionalApplicationParameters),n)),e.rebootOverrideData&&e.rebootOverrideData.queryOverrides&&(n=f(f({},n),e.rebootOverrideData.queryOverrides)),function(e,t,i,o,n){var s=function(e){var t={},i=e.indexOf("?");return-1===i||i===e.length-1||e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(e){if(e){var i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}})),t}(e);"teams"!==s.uih&&"owa"!==s.uih||(s.hhdr="1","teams"===s.uih&&(s.jsapisr="1"));var r=e.indexOf("?"),a=-1===r?e.concat("?"):e.substring(0,r+1);t.UiLocale&&(s.ui=encodeURIComponent(t.UiLocale));t.DataLocale&&(s.rs=encodeURIComponent(t.DataLocale));t.HostSessionId&&(s.hid=encodeURIComponent(t.HostSessionId));t.DisableChat&&(s.dchat="1");t.SessionContext&&(s.sc=encodeURIComponent(t.SessionContext));i&&i.WopiSrc&&(s.wopisrc=encodeURIComponent(i.WopiSrc));t.CookieCompliant&&(s.mscc="1");o&&(o.entryPoint&&(s.wdorigin=encodeURI(o.entryPoint)),o.userClickTime&&(s.wdhostclicktime=o.userClickTime.toString()));s=f(f(f({},s),t.WdParams),n);var c={};for(var p in s)c[p.toLowerCase()]=s[p];var l=[];for(var p in c)c[p]&&l.push(p.concat("=",c[p]));return a.concat(l.join("&"))}(o,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitializeDiagnostics,n)}function Se(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"}!function(e){e.ExcelInstantShellEnabled="ExcelInstantShellEnabled",e.SettingsFetchPeriod="BootstrapperSettingsFetchPeriod"}(de||(de={}));var we,ve,Ie,ye,Te,Ae,Fe=!1,Pe=!1,We=["xlviewerinternal.aspx","xlembed.aspx"],Ce=0;function Ue(e,t,i){Ie=e,ye=t,Ae=i,be(),setTimeout((function(){!function e(){if(Ce>=3)return void Ie.ULS.traceTag(595350870,z.WopiPendingApplication,r.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts3");if(be(),Fe)setTimeout((function(){(!Pe||Ce>0)&&Ie.ULS.traceTag(595350872,z.WopiPendingApplication,r.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+Pe+" after first flush retry attempt: "+Ce)}),ve);else{if(Ce+=1,Ie.ULS.traceTag(595350871,z.WopiPendingApplication,r.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+Ce),Ae.isFeatureEnabled(H.ExcelLandingPageObserverRetry)&&1===Ce)document.getElementById(ye).submit();setTimeout((function(){e()}),we)}}()}),we),Ie.ULS.traceTag(594622165,z.WopiPendingApplication,r.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver called")}function be(){we=3750,ve=6e3;var e=function(){if(window&&window.navigator){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e?e.effectiveType:void 0}}();if(void 0!==e)switch(void 0!==Te&&Te!==e&&Ie.ULS.traceTag(595350873,z.WopiPendingApplication,r.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+Te+" currentConnection: "+e+" First Flush: "+Fe+" Second Flush:"+Pe),Te=e,e){case"4g":we=3750,ve=6e3;break;case"3g":we=5e3,ve=8e3;break;case"2g":we=1e4,ve=24e3;break;case"slow-2g":we=2e4,ve=4e4}}var Ee,Oe=1e3;function Me(e,t,i,o,n,s,r){var a=function(e,t,i,o,n){var s=e.ownerDocument.createElement("iframe");s.name=o||"WebApplicationFrame",s.id="WebApplicationFrame",s.src="",s.title="Office Online Frame",s.width="100%",s.height="100%",s.marginWidth="0",s.marginHeight="0",s.style.left="0",s.style.top="0",s.style.right="0",s.style.bottom="0",s.style.display="block",s.style.position="absolute",s.style.backgroundColor="transparent",s.style.border="none",s.frameBorder="0",s.setAttribute("allowfullscreen","true"),s.setAttribute("allowTransparency","true"),i&&s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var r=M(t);return s.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(s.onload=n),e.appendChild(s),s}(e,t,o,n);return function(e){return We.some((function(t){return-1!==e.indexOf(t)}))}(t)&&Ue(s,"office_form",r),function(e,t,i,o){!function(e,t){t[Ee.wacFrameComputedHeightPx]=String(e.offsetHeight),t[Ee.wacFrameComputedWidthPx]=String(e.offsetWidth),t[Ee.wacFrameTouchMode]=String(ee()),t[Ee.wacFrameHighContrast]=String(function(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(e){return!1}}())}(e,o);var n=t.ownerDocument,s=n.createElement("form");for(var r in s.id="office_form",s.name="office_form",s.action=i,s.target=e.name,s.method="POST",o){var a=n.createElement("input");a.type="hidden",a.name=r,a.value=o[r],s.appendChild(a)}return t.appendChild(s),s.submit(),e}(a,e,t,i)}function Re(e,t){var i={};if(e.wopiInfo&&(i[Ee.wacFrameAccessToken]=e.wopiInfo.AccessToken,i[Ee.wacFrameAccessTokenTtl]=Se(e.wopiInfo)),e.wopiPrecheckInfo.BundleInfo&&e.wopiPrecheckInfo.BundleInfo.Url&&e.wopiPrecheckInfo.BundleInfo.Url.length>0)if(i[Ee.wacFrameBundleSource]=e.wopiPrecheckInfo.BundleInfo.Url,null!=e.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==e.wopiPrecheckInfo.BundleInfo.BundleStaleness){var o=e.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();t.ULS.traceTag(595716227,z.WopiPendingApplication,r.Info,"Content bundle staleness - "+o),i[Ee.wacFrameBundleStaleness]=o}else t.ULS.traceTag(595716228,z.WopiPendingApplication,r.Info,"Content bundle staleness does not exist");if(e.wopiPrecheckInfo.FileGetUrl&&(i[Ee.wacFrameFileGetUrl]=e.wopiPrecheckInfo.FileGetUrl),e.wopiPrecheckInfo.FileName){var n=e.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==n){var s=e.wopiPrecheckInfo.FileName.substring(n+1);s&&(i[Ee.wacFrameFileExtension]=s)}i[Ee.wacFrameFileName]=e.wopiPrecheckInfo.FileName}return e.newFileTemplateSource&&e.newFileTemplateSource.FileSize?i[Ee.wacFrameFileSize]=e.newFileTemplateSource.FileSize.toString():e.wopiPrecheckInfo.FileSize&&(i[Ee.wacFrameFileSize]=e.wopiPrecheckInfo.FileSize.toString()),e.sessionInformation.UserId&&(i[Ee.wacFrameUserId]=e.sessionInformation.UserId),e.sessionInformation.OwnerId&&(i[Ee.wacFrameOwnerId]=e.sessionInformation.OwnerId),e.sessionInformation.SessionContext&&(i[Ee.wacFrameSessionContext]=e.sessionInformation.SessionContext),e.diagnostics&&(i[Ee.wacFrameHostDiagnostics]=JSON.stringify(e.diagnostics)),i[Ee.wacFrameFeatureStatus]=function(e,t){var i={};if(e)for(var o in H){var n=e.isFeatureEnabled(o);void 0!==n&&(i[o]=n?"1":"0")}if(t&&t.wdFlights)for(var s=t.wdFlights.toLowerCase(),r=0,a=s.split(",");r<a.length;r++){var c=a[r];"et-treatment"!==c&&"et-control"!==c||(i[H.EnterpriseTemplates]="et-treatment"===c?"1":"0")}return JSON.stringify(i)}(e.featureManager,e.sessionInformation.WdParams),e.applicationCustomSettings&&e.applicationCustomSettings.HostUIControls&&(i[Ee.wacFrameHostUIControlOverrides]=JSON.stringify(e.applicationCustomSettings.HostUIControls)),i[Ee.wacFrameHighDpi]=String(window.devicePixelRatio>1.24),i[Ee.wacSoftBlockedBrowser]=String(te()),i[Ee.wacFrameHostName]=e.sessionInformation.HostName,e.newFileTemplateSource&&(i[Ee.wacFrameTemplateUrl]=e.newFileTemplateSource.FileGetUrl),e.newFileTemplateSource&&e.newFileTemplateSource.DocUniqueId?i[Ee.wacFrameDocID]=e.newFileTemplateSource.DocUniqueId:e.wopiPrecheckInfo.DocUniqueId&&(i[Ee.wacFrameDocID]=e.wopiPrecheckInfo.DocUniqueId),e.newFileTemplateSource&&e.newFileTemplateSource.ETag?i[Ee.wacFrameETag]=e.newFileTemplateSource.ETag:e.wopiPrecheckInfo.ETag&&(i[Ee.wacFrameETag]=e.wopiPrecheckInfo.ETag),i}!function(e){e.wacFrameAccessToken="access_token",e.wacFrameAccessTokenTtl="access_token_ttl",e.wacFrameBundleSource="bundleSrc",e.wacFrameBundleStaleness="bundleStaleness",e.wacFrameFileGetUrl="fileGetUrl",e.wacFrameFileExtension="fileExtension",e.wacFrameFileSize="fileSize",e.wacFrameFileName="fileName",e.wacFrameOwnerId="owner_id",e.wacFrameUserId="user_id",e.wacFrameSessionContext="sc",e.wacFrameHostDiagnostics="host_diagnostics",e.wacFrameHighDpi="highDpi",e.wacFrameComputedHeightPx="frameHeightPx",e.wacFrameComputedWidthPx="frameWidthtPx",e.wacFrameHostFlights="hostFlights",e.wacFrameHighContrast="highContrast",e.wacFrameTouchMode="touchMode",e.wacFrameHostUIControlOverrides="huictrls",e.wacSoftBlockedBrowser="softBlockedBrowser",e.wacFrameHostName="hostName",e.wacFrameFeatureStatus="feature_status",e.wacFrameTemplateUrl="templateUrl",e.wacFrameETag="ETag",e.wacFrameDocID="DocID"}(Ee||(Ee={}));var Le=function(){function e(e,t,i,o,n,s,r,a){if(this.wacAppCompleteOrFailReceived=!1,this.ulsHeartBeatTimer=void 0,this.logTimers=[],void 0===t)throw new TypeError("bootFlowInfo");if(t.isSingleStepBoot&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.appParams=e,this.bootFlowInfo=t,this.logger=n,this.postMessenger=s,this.fnOnWopiBootSuccess=r,this.fnOnWopiBootFailure=a,this.appInitDiagnostics=i,this.sessionTraces=o,this.sessionTraces.wopiInitializeTime=Date.now()}return e.prototype.Boot=function(){var e=this;this.logger.ULS.traceTag(596444241,z.WopiPendingApplication,r.Info,"Initializing WAC frame");var t=me(this.appParams,this.bootFlowInfo,!0),i=Re(this.appParams,this.logger);if(this.beginUlsHeartBeat(E(t)?3e3:5e3),this.postMessenger.registerMessagePayloadHandler(A.BootState,(function(t){e.handleWacAppBootState(t)})),this.postMessenger.registerMessagePayloadHandler(A.TrustFrame,(function(t){e.handleTrustFrameRequest(t)})),this.bootFlowInfo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(t,i),this.bootFlowInfo.ignoreWacFramePostMessages){var o=this.getApplicationState();this.fnOnWopiBootSuccess(o)}return this.logger.ULS.traceTag(595661019,z.WopiPendingApplication,r.Info,"Created Wac Frame"),this.innerApplicationFrame},e.prototype.bootWacFrame=function(e,t){this.appInitDiagnostics.officeFrameCreateTime=Date.now(),this.sessionTraces.frameCreateStartTime=this.appInitDiagnostics.officeFrameCreateTime;var i=!(!this.appParams.sessionInformation.WdParams||!this.appParams.sessionInformation.WdParams.wdSandboxWacFrame),o=this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.appFrameName;this.innerApplicationFrame=Me(this.appParams.container,e,t,i,o,this.logger,this.appParams.featureManager),this.postMessenger.activate(this.innerApplicationFrame)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(A.BootSucceeded,(function(t){e.handleWacCompleteMessage(t)})),this.postMessenger.registerMessagePayloadHandler(A.BootFailed,(function(t){e.handleWacFailureMessage(t)})),this.logTimers.push(window.setTimeout((function(){return e.timeoutWacAppCompleteOrFail()}),15e3)),this.logTimers.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(1)}),6e4)),this.logTimers.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(2)}),18e4))},e.prototype.handleWacAppBootState=function(e){var t=e&&e.state?e.state:"unknown";this.logger.ULS.traceTag(595714271,z.WopiPendingApplication,r.Info,"WAC Boot App state:["+t+"]"),function(e){"PageLoadSkeleton Presented"===e?Fe=!0:"BootstapContext Recieved"===e&&(Pe=!0)}(t)},e.prototype.handleTrustFrameRequest=function(e){var t=window===window.top||window.parent===window.top&&window.location.origin===window.top.origin;this.logger.ULS.traceTag(595653903,z.WopiPendingApplication,r.Info,"Top frame is trusted: "+t),this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,F.TrustFrame,{isTopFrameTrusted:t})},e.prototype.handleWacCompleteMessage=function(e){if(this.logger.ULS.traceTag(595986314,z.WopiPendingApplication,r.Info,"Received wac complete message"),this.logger.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444234,z.WopiPendingApplication,r.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(F.BootSucceededAck,{}),G(this.appInitDiagnostics,e);var t=this.getApplicationState();this.fnOnWopiBootSuccess(t),this.sendJsApiDiagnosticsToWacFrame(this.appParams.diagnostics)}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.innerApplicationFrame}},e.prototype.handleWacFailureMessage=function(e){if(this.logger.ULS.traceTag(595986315,z.WopiPendingApplication,r.Error,"Received wac failed message"),this.logger.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444235,z.WopiPendingApplication,r.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(F.BootFailedAck,{});var t={errorType:k.WacFailed,errorObject:{}};e&&(t.errorObject=e.Error,this.sessionTraces.error=t),this.fnOnWopiBootFailure(t)}},e.prototype.timeoutWacAppCompleteOrFail=function(){this.wacAppCompleteOrFailReceived||this.logger.ULS.traceTag(596444236,z.WopiPendingApplication,r.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.clearLogTimers=function(){for(var e=0;e<this.logTimers.length;e+=1)this.logTimers[e]&&window.clearTimeout(this.logTimers[e]);this.logTimers=[]},e.prototype.logWarningOnNoAppComplete=function(e){this.wacAppCompleteOrFailReceived||(this.logger.ULS.traceTag(594901218,z.WopiPendingApplication,r.Warning,"Boot_NotComplete_"+(e||"Final")),this.logger.ULS.flush())},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(F.JsApiDiagnostics,e)},e.prototype.beginUlsHeartBeat=function(e){var t=this;this.ulsHeartBeatStart=Date.now(),this.ulsHeartBeatTimer=window.setInterval((function(){t.logger.ULS.traceTag(595724178,z.WopiPendingApplication,r.Info,"Boot_HeartBeat"),Date.now()-t.ulsHeartBeatStart>3e5&&(t.logWarningOnNoAppComplete(),t.endUlsHeartBeat())}),e)},e.prototype.endUlsHeartBeat=function(){this.ulsHeartBeatTimer&&(window.clearInterval(this.ulsHeartBeatTimer),this.ulsHeartBeatTimer=void 0)},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955718,z.WopiPendingApplication,r.Info,"Attempted to send postmessage: "+e)},e}();var xe,_e=function(){function e(e,t,i,o,n,s,r,a,c){var p=this;this.wacFrameIsLoaded=!1,this.initializeCompleted=!1,this.completeOrFailCalled=!1,this.sessionFailureReason=null,this.parallelizeStartSession=!0,this.wacAcceptsStartSessionComplete=!1,this.wacAppSessionCompletionMessageAck=!1,this.appParams=e,this.bootFlowInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.fnOnWopiBootSuccess=a,this.fnOnWopiBootFailure=c,this.sessionTraces=s,this.sessionTraces.wopiPendingInitializeTime=Date.now(),this.cleanup=r,ce(),window.setTimeout((function(){return p.timeoutCompleteOrFail()}),5e3)}return e.prototype.Complete=function(e,t){if(this.completeOrFailCalled)this.logger.ULS.traceTag(596444184,z.WopiPendingApplication,r.Warning,"Complete called after Complete/Fail already called");else{this.logger.ULS.traceTag(596444185,z.WopiPendingApplication,r.Info,"Complete called."),this.completeOrFailCalled=!0,this.wopiInfo=e,this.sessionTraces.wopiPendingCompleteTime=Date.now();try{this.bootFlowInfo.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.wacFrameIsLoaded&&this.sendWacPostMessage(F.PendingAppCompleteReceived,{}),this.updateBrowserHistoryForCreateNew(t)}catch(e){this.logger.ULS.traceTag(596444186,z.WopiPendingApplication,r.Error,"Unexpected script error: "+S(e))}finally{this.logger.ULS.flush()}}},e.prototype.Fail=function(e){this.completeOrFailCalled?this.logger.ULS.traceTag(596444187,z.WopiPendingApplication,r.Warning,"Fail called after Complete/Fail already called"):(this.logger.ULS.traceTag(596444188,z.WopiPendingApplication,r.Warning,"Fail called. Reason: "+(e?JSON.stringify(e):"N/A")),this.completeOrFailCalled=!0,this.bootFlowInfo.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(e),this.logger.ULS.flush())},e.prototype.Dispose=function(e,t,i){var o=this;pe(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete o.innerApplicationFrame,t&&t(),o.cleanup(),o.postMessenger.dispose()}),i)},e.prototype.Boot=function(){this.bootFlowInfo.isSingleStepBoot||this.bootTwoStepFlow(),this.logger.ULS.flush()},e.prototype.bootTwoStepFlow=function(){var e=this;this.logger.ULS.traceTag(596444231,z.WopiPendingApplication,r.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return e.timeoutWacReadyMessage()}),5e3),this.populateWacFrameEventHandlersForTwoStepFlow();var t=new Le(this.appParams,this.bootFlowInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=t.Boot()},e.prototype.populateWacFrameEventHandlersForTwoStepFlow=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(A.InitReady,(function(t){e.handleWacReadyMessage(t)})),this.postMessenger.registerMessagePayloadHandler(A.InitFrameLoaded,(function(t){e.handleWacFrameLoadedMessage(t)})),this.postMessenger.registerMessagePayloadHandler(A.SessionCompleteAck,(function(t){e.handleWacFrameSessionCompleteAckMessage(t)}))},e.prototype.completeTwoStepFlow=function(){var e={ParallelizeStartSession:this.parallelizeStartSession,WacFrameIsLoaded:this.wacFrameIsLoaded,WacAcceptsStartSessionComplete:this.wacAcceptsStartSessionComplete};this.logger.ULS.traceTag(596444232,z.WopiPendingApplication,r.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(e)),!this.parallelizeStartSession||this.wacFrameIsLoaded&&!this.wacAcceptsStartSessionComplete?this.wacFrameIsLoaded&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeSingleStepFlow=function(){this.logger.ULS.traceTag(596444233,z.WopiPendingApplication,r.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.appParams.wopiInfo=this.wopiInfo;var e=new Le(this.appParams,this.bootFlowInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=e.Boot()},e.prototype.failTwoStepFlow=function(e){this.wacFrameIsLoaded?(this.logger.ULS.traceTag(595968481,z.WopiPendingApplication,r.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.logger.ULS.traceTag(595968482,z.WopiPendingApplication,r.Warning,"Fail was called on the session prior to WacReady."),this.sessionFailureReason=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.logger.ULS.traceTag(596444189,z.WopiPendingApplication,r.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(F.FailSession,e)},e.prototype.failSingleStepFlow=function(){this.logger.ULS.traceTag(596444190,z.WopiPendingApplication,r.Warning,"Fail called during single step boot, calling host failure callback..."),this.fnOnWopiBootFailure({errorType:k.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.timeoutWacReadyMessage=function(){this.wacFrameIsLoaded||(this.logger.ULS.traceTag(596444191,z.WopiPendingApplication,r.Warning,"Timeout Wac Ready"),this.fnOnWopiBootFailure({errorType:k.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.completeOrFailCalled||(this.sessionTraces.timeoutCompleteOrFail=Date.now(),this.logger.ULS.traceTag(596444192,z.WopiPendingApplication,r.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.sessionTraces)))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,t,i){this.wacAppSessionCompletionMessageAck||(this.logger.ULS.traceTag(596444193,z.WopiPendingApplication,r.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,t,i+1))},e.prototype.handleWacReadyMessage=function(e){if(this.sessionTraces.readyMessageReceiveTime=Date.now(),this.sendWacPostMessage(F.InitReadyAck,{}),this.wacFrameIsLoaded)this.logger.ULS.traceTag(596444194,z.WopiPendingApplication,r.Info,"Received multiple ready messages - frame is already loaded.");else{this.wacFrameIsLoaded=!0,this.wacAcceptsStartSessionComplete=e&&e.CanAcceptStartSessionComplete;var t={AcceptStartSessionComplete:this.wacAcceptsStartSessionComplete,ParallelizeStartSession:this.parallelizeStartSession,StartSessionResponse:null!=this.startSessionResponse,WopiInfo:null!=this.wopiInfo};this.logger.ULS.traceTag(596444195,z.WopiPendingApplication,r.Info,"HandleWacReadyMessage - "+JSON.stringify(t)),this.completeOrFailCalled&&(this.sessionFailureReason?this.sendFailurePostMessageToWacFrame(this.sessionFailureReason):this.sendWacPostMessage(F.PendingAppCompleteReceived,{})),this.parallelizeStartSession&&this.wacAcceptsStartSessionComplete?this.startSessionResponse&&this.startSessionCompleted():this.wopiInfo&&this.sendWopiInfoToWacFrame(),G(this.appInitDiagnostics,e)}},e.prototype.handleWacFrameLoadedMessage=function(e){G(this.appInitDiagnostics,e)},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.wacAppSessionCompletionMessageAck=!0,this.sessionTraces.sessionCompleteAckReceivedTime=Date.now()},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,t){this.sendSessionCompletionMessageWithRetryHelper(e,t,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,t,i){var o=this;if(i>3)this.logger.ULS.traceTag(596444224,z.WopiPendingApplication,r.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.logger.ULS.traceTag(596444225,z.WopiPendingApplication,r.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+Date.now());var n=Date.now();1===i&&(this.startSessionResponse&&this.startSessionResponse.Diagnostics&&(this.startSessionResponse.Diagnostics.completeMessageCreateTime=n),this.sessionTraces.completeMessageCreateTime=n),t.Diagnostics.completeMessageSendTime=n,this.sessionTraces.completeMessageSendTime=n,this.sendWacPostMessage(e,t),window.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(e,t,i)}),1e3)}},e.prototype.makeStartSessionRequest=function(){var e=this;this.logger.ULS.traceTag(596444226,z.WopiPendingApplication,r.Info,"Making parallelized startSession request.");var t=this.buildStartSessionUrl(this.wopiInfo),i={"Content-Type":"application/x-www-form-urlencoded"},o="access_token="+encodeURIComponent(this.wopiInfo.AccessToken)+"&access_token_ttl="+encodeURIComponent(Se(this.wopiInfo));this.sessionTraces.startSessionStartTime=Date.now(),function(e,t,i,o){var n=new XMLHttpRequest;for(var s in n.onreadystatechange=function(){if(n&&4===n.readyState){if(void 0===n.status||0===n.status)return;try{o&&o(n)}finally{null!=n&&(n.onreadystatechange=function(){})}}},n.open("POST",e),i)n.setRequestHeader(s,i[s]);n.send(t)}(t,o,i,(function(t){return e.onStartSessionRequestCompleted(t)}))},e.prototype.onStartSessionRequestCompleted=function(e){if(this.sessionTraces.startSessionCompleteTime=Date.now(),this.sessionTraces.startSessionResponseStatus=e.status,this.startSessionResponse={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,startSessionStartTime:this.sessionTraces.startSessionStartTime,startSessionCompleteTime:this.sessionTraces.startSessionCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}},this.logger.ULS.traceTag(596444227,z.WopiPendingApplication,r.Info,"StartSession request completed with status code: "+this.startSessionResponse.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.wacFrameIsLoaded&&this.wacAcceptsStartSessionComplete)this.startSessionCompleted();else{var t={WacFrameIsLoaded:this.wacFrameIsLoaded,InitializeCompleted:this.initializeCompleted};this.logger.ULS.traceTag(596444228,z.WopiPendingApplication,r.Info,"StartSessionCompleted not called - "+JSON.stringify(t))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.initializeCompleted){this.initializeCompleted=!0,this.logger.ULS.traceTag(596444229,z.WopiPendingApplication,r.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.wopiInfo.WopiSrc,AccessToken:this.wopiInfo.AccessToken,AccessTokenTtl:Se(this.wopiInfo)},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(F.PendingSessionComplete,e)}},e.prototype.startSessionCompleted=function(){200===this.startSessionResponse.StartSessionResponse.RequestStatus?this.initializeCompleted||(this.initializeCompleted=!0,this.sendSessionCompletionMessageWithRetry(F.StartSessionComplete,this.startSessionResponse)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(e){var t=this.appParams.applicationBaseUrl+"wordeditorstartsession.ashx",i=me(this.appParams,this.bootFlowInfo,!1);return t=J(t+="?"+i.substring(i.indexOf("?")+1),"WOPISrc",encodeURIComponent(e.WopiSrc)),t=J(t,"build",encodeURIComponent(D())),t=J(t,"WacUserType",encodeURIComponent("WOPI")),this.appParams.wopiPrecheckInfo.FileGetUrl&&(t=J(t,"fileGetUrlPresent","1")),t},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.appParams.isCreateNew){if(!e||!e.NewFilePath)return void this.logger.ULS.traceTag(596444230,z.WopiPendingApplication,r.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e}();!function(e){e.AckExpected="ackExpected",e.ErrorObject="errorObject",e.ErrorType="errorType",e.IsDisabled="isDisabled",e.NewPageNumber="newPage",e.NewZoomLevel="newLevel",e.PageCount="pageCount"}(xe||(xe={}));var De=function(){function e(e,t){var i=this;if(this.isActivated=!1,this.messageListener=function(e){return i.handleWacFramePostMessage(e)},this.enforceSameWindow=!1,this.isFastfood=!1,this.isMsit=!1,this.eventHandlers={},!e)throw new Error("Missing origin for PostMessageHandler");this.isFastfood=E(e),this.isMsit=O(e),this.logger=t,this.setOrigin(e)}return e.prototype.registerMessagePayloadHandler=function(e,t){if(this.eventHandlers[e])throw new Error("Duplicate registration!");this.eventHandlers[e]=t},e.prototype.removeMessageHandler=function(e){delete this.eventHandlers[e]},e.prototype.sendPostMessage=function(e,t,i){if(e){this.logger.ULS.traceTag(596464334,z.WopiPendingApplication,r.Info,"Sending message: "+t);var o={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(e,JSON.stringify(o),this.origin)}else this.logger.ULS.traceTag(595948308,z.WopiPendingApplication,r.Info,"Missing target for SendPostMessage")},e.prototype.activate=function(e,t){void 0===t&&(t=!1),this.innerApplicationFrame=e,this.enforceSameWindow=t,this.isActivated||(window.addEventListener("message",this.messageListener,!1),this.isActivated=!0)},e.prototype.postMessageForCommand=function(e,t,i){var o=b[t];o?(this.logger.ULS.traceTag(595702598,z.WopiPendingApplication,r.Info,"Sending message "+o+" for command "+t),this.sendPostMessage(e,o,i)):this.logger.ULS.traceTag(595702599,z.WopiPendingApplication,r.Warning,"No mapping for command "+t)},e.prototype.dispose=function(){for(var e=0,t=Object.keys(this.eventHandlers);e<t.length;e++){var i=t[e];delete this.eventHandlers[i]}this.isActivated&&(window.removeEventListener("message",this.messageListener,!1),this.isActivated=!1)},e.prototype.sendAckBack=function(e,t,i){if(e){var o={MessageId:F.Ack,CorrelationId:i,SendTime:Date.now()};this.logger.ULS.traceTag(595732176,z.WopiPendingApplication,r.Info,"Sending Ack back"),e.postMessage(JSON.stringify(o),t)}else this.logger.ULS.traceTag(595736136,z.WopiPendingApplication,r.Info,"Missing target to send Ack back")},e.prototype.handleWacFramePostMessage=function(e){var t=!1,i=!0,o="",n=!1;if(this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow&&(t=!0,i=e.source===this.innerApplicationFrame.contentWindow),e.origin&&(n=(o=R(e.origin,2).toLowerCase())===this.receivingDomain),!this.isFastfood&&(!this.isMsit||n&&i)||this.logger.ULS.traceTag(595730526,z.WopiPendingApplication,r.Info,"Window is available: "+t+", window is valid: "+i+", origin is valid: "+n+", expected origin: "+this.receivingDomain+", actual origin: "+o),n&&(!this.enforceSameWindow||i)){var s;try{s=JSON.parse(e.data)}catch(t){return this.logger.ULS.traceTag(596464282,z.WopiPendingApplication,r.Info,"Failed to parse event data: "+S(t)+"."),void(this.isFastfood&&this.logger.ULS.traceTag(595732175,z.WopiPendingApplication,r.Info,"string"==typeof e.data?"Length of event data: "+e.data.length+". First 200 characters of event data: "+e.data.substring(0,200):"Event data: "+JSON.stringify(e.data)))}var a=s.MessageId;if(a){this.logger.ULS.traceTag(595714715,z.WopiPendingApplication,r.Info,"Received messageId: "+a+", correlation: "+s.CorrelationId),a!==A.BootSucceeded&&a!==A.LoadingStatus||this.setOrigin(e.origin),s.Values&&s.Values[xe.AckExpected]&&this.sendAckBack(e.source,e.origin,s.CorrelationId);var c=this.eventHandlers[a];if(c){this.logger.ULS.traceTag(596464288,z.WopiPendingApplication,r.Info,"Processing message: "+a);try{c(s.Values||{})}catch(e){this.logger.ULS.traceTag(594556386,z.WopiPendingApplication,r.Error,"Handler error: "+S(e))}}else this.logger.ULS.traceTag(596464289,z.WopiPendingApplication,r.Info,"No handler found for message id: "+a)}else(this.isFastfood||this.isMsit)&&this.logger.ULS.traceTag(595730520,z.WopiPendingApplication,r.Info,"Could not find message id")}},e.prototype.sendPostMessageInternal=function(e,t,i){e.postMessage(t,i)},e.prototype.setOrigin=function(e){var t=e.toLowerCase();this.origin&&this.origin!==t&&this.logger.ULS.traceTag(596128131,z.WopiPendingApplication,r.Warning,"Updating origin:"+this.origin+"->"+t),this.origin=t,this.receivingDomain=R(t,2),this.isFastfood=E(t),this.isMsit=O(t)},e}(),He={getLogger:function(e,t){var i=I(e,{remoteUlsEndpoint:t});return{ULS:{traceTag:i.ULS.sendTraceTag,flush:i.ULS.flush,flushOnClose:i.ULS.flushOnClose}}}};var ke=function(){function e(){var e=this;if(this.visibilityChangeEvents=[],this.eventHandlers=[],this.visibilityChangeHandler=function(){return e.handleVisibilityChange()},"hidden"===document.visibilityState){var t={visibility:document.visibilityState,time:Date.now(),initialState:!0};this.visibilityChangeEvents.push(t)}document.addEventListener("visibilitychange",this.visibilityChangeHandler)}return e.prototype.RegisterEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.RemoveEventHandler=function(e){if(e){var t=this.eventHandlers.indexOf(e);this.eventHandlers.splice(t,1)}},e.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.GetVisibilityChangeEvents=function(){return this.visibilityChangeEvents},e.prototype.Dispose=function(){this.Stop(),this.eventHandlers=[],this.visibilityChangeEvents=[]},e.prototype.handleVisibilityChange=function(){var e={visibility:document.visibilityState,time:Date.now(),initialState:!1};this.visibilityChangeEvents.push(e);for(var t=0,i=this.eventHandlers;t<i.length;t++){var o=i[t];o&&o(e)}},e}();var Be,Ne=function(){function e(e,t){this.appFactory=e,this.bootstrapperParameters=t}return e.prototype.GetVersion=function(){return D()},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var t=document.createElement("link");t.rel="prefetch";var i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;var o=document.getElementsByTagName("head")[0];null!=o&&void 0!==o&&o.appendChild(t)}},e.prototype.InitializeWopiPending=function(e,t,i,o,n){var s,a,c,p;try{var l=Date.now();!function(e){if(void 0===e)throw new TypeError("initParams");var t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");var i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");var n=e.WopiPrecheckInfo;if(void 0===n||void 0===n.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(e),function(e){if(e.RebootOverrideData){var t=e.RebootOverrideData.mode.toLowerCase();if("view"!==t&&"edit"!==t)throw new Error("Unknown mode in RebootOverrideData");0,e.RebootOverrideData.queryOverrides.wdforcedmode="view"===t?"View":"Edit"}}(e);var d=void 0,g=void 0;i?d=i:e.RebootOverrideData&&!e.RebootOverrideData.isNewSession&&e.RebootOverrideData.previousSessionId?d=e.RebootOverrideData.previousSessionId:(d=(s=y())[0],g=s[1]);var u=function(e,t,i,o,n){return void 0===n&&(n=!1),e.SessionInformation.IsCore&&(e.SessionInformation.HideViewerToolbar=!0),function(e,t){e.SessionInformation.WdParams||(e.SessionInformation.WdParams={});if(e.SessionInformation.WdParams.wd)return;t.substring(1).split("&").filter((function(t){if(0===t.indexOf("wd")){var i=t.split("=");i[0].length>2&&(e.SessionInformation.WdParams[i[0]]=i[1])}})),e.RebootOverrideData&&e.RebootOverrideData.isNewSession&&e.RebootOverrideData.previousSessionId&&(e.SessionInformation.WdParams.wdprevioussession=e.RebootOverrideData.previousSessionId)}(e,window.location.search),{container:e.Container,sessionInformation:e.SessionInformation,applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:e.Diagnostics},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,sessionId:t,applicationBaseUrl:L(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceSingleStepBoot:n,isCreateNew:e.WopiPrecheckInfo.IsNewFile||"1"===V(e.ApplicationUrl,"new"),featureManager:i||w(e.FnIsFeatureEnabled,o),newFileTemplateSource:e.NewFileTemplateSource,rebootOverrideData:e.RebootOverrideData}}(e,d,n,a=t||He.getLogger(d,L(e.ApplicationUrl)+"RemoteUls.ashx"),this.bootstrapperParameters.forceSingleStepBoot);ge(u.applicationBaseUrl,a),u.diagnostics.HostInitializeDiagnostics&&(u.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=l),Q(a,u,g);var h,m=function(){return $(a,"OnBeforeUnload",!0)},v=function(){return $(a,"OnPageHide",!0)},I=function(){return $(a,"VisibilityChange_"+document.visibilityState,!0)},T=function(e){return function(e,t){if(e){var i=S(t);/{("isTrusted":\w{4,5})?}/.test(i)||(e.ULS.traceTag(594895886,z.WopiPendingApplication,r.Warning,"Unhandled Error:"+i),e.ULS.flush())}}(a,e)};window.addEventListener("beforeunload",m,{capture:!0,once:!0}),window.addEventListener("pagehide",v,{capture:!0}),window.addEventListener("visibilitychange",I,{capture:!0}),window.addEventListener("error",T,{capture:!0});var F=e&&e.BootstrapperUrl;F&&(h=this.periodicPrefetch(F,a));var P=function(){window.removeEventListener("beforeunload",m,{capture:!0}),window.removeEventListener("pagehide",v,{capture:!0}),window.removeEventListener("visibilitychange",I,{capture:!0}),window.removeEventListener("error",T,{capture:!0}),window.clearInterval(h)},W=M(e.ApplicationUrl),C=o||new De(W,a),U=new ke,b={},E=function(e,t){var i={isSingleStepBoot:e.forceSingleStepBoot,bootFlowType:e.forceSingleStepBoot?N.forceSingleStepBoot:N.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(e.forceSingleStepBoot,i.isSingleStepBoot){var o={singleStepBootIsRequired:!0,singleStepBootReason:i.bootFlowType,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:i.ignoreWacFramePostMessages};t.ULS.traceTag(596444182,z.WopiPendingApplication,o.irmEnabled?r.Warning:r.Info,JSON.stringify(o))}else t.ULS.traceTag(596444183,z.WopiPendingApplication,r.Info,"Received input valid for two step flow");return i}(u,a),O=f(f({},u.diagnostics.HostInitializeDiagnostics),{officeSessionId:u.sessionId,officeBootstrapperVersion:D(),hostName:u.sessionInformation.HostName}),R=function(e,t,i,o,n,s,a,c,p){return function(l){K(e,n,s),Z(n,o,r.Info),o.ULS.traceTag(596448985,z.WopiPendingApplication,r.Info,JSON.stringify(e));var d=p(t,o,i,a,l);try{c(d,e)}catch(e){o.ULS.traceTag(595719171,z.WopiPendingApplication,r.Error,"Exception thrown from host's success callback: "+S(e))}X(o)}}(O,u.sessionId,C,a,b,U,P,e.FnOnInitializeSuccess,this.appFactory),x=function(e,t,i,o,n){return function(s){K(e,i,o),Z(i,t,r.Warning),t.ULS.traceTag(596448986,z.WopiPendingApplication,r.Error,JSON.stringify({error:s,appInitDiagnostics:e}));try{n(s,e)}catch(e){t.ULS.traceTag(595719172,z.WopiPendingApplication,r.Error,"Exception thrown from host's failure callback: "+S(e))}X(t)}}(O,a,b,U,e.FnOnInitializeFailure);if("undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}}),e.FnOnAppModeSwitched&&C.registerMessagePayloadHandler(A.ModeSwitched,e.FnOnAppModeSwitched),e.WopiPrecheckInfo.ReadOnly&&e.FnOnAppModeSwitched&&e.FnOnAppModeSwitched({NewMode:"view"}),F&&this.bootstrapperParameters.preloader&&this.bootstrapperParameters.preloader.shouldPreload(u.applicationUrl))try{if(u.featureManager&&u.featureManager.isFeatureEnabled(H.H2StaticContent)){a.ULS.traceTag(595645891,z.WopiPendingApplication,r.Info,"HTTP2 preload enabled");var _=(c=F,p=new RegExp("(c[1-5])h?(-)"),c.replace(p,"$1h$2"));this.bootstrapperParameters.preloader.preload(_,a,u.featureManager)}else this.bootstrapperParameters.preloader.preload(F,a,u.featureManager)}catch(e){a.ULS.traceTag(595943884,z.WopiPendingApplication,r.Error,S(e))}var B=new _e(u,E,O,a,C,b,P,R,x);return B.Boot(),B}catch(t){return a&&(a.ULS.traceTag(596459925,z.WopiPendingApplication,r.Error,k.AppInitError+": "+S(t)),a.ULS.flushOnClose()),void e.FnOnInitializeFailure({errorType:k.AppInitError,errorObject:t},void 0)}},e.prototype.periodicPrefetch=function(e,t){var i=this;return window.setInterval((function(){i.Prefetch({BootstrapperUrl:e}),t.ULS.traceTag(595895774,z.WopiPendingApplication,r.Info,"Prefetching "+j(e))}),36e5)},e}();var ze,Ve=((Be={})[A.AccessibilityLoopCompleted]=h.AccessibilityLoopCompleted,Be[A.Conversation]=h.Conversation,Be[A.CopyAndEdit]=h.CopyAndEdit,Be[A.Download]=h.Download,Be[A.Error]=h.Error,Be[A.FileEmbed]=h.FileEmbed,Be[A.FileProperties]=h.FileProperties,Be[A.FileRenamed]=h.FileRenamed,Be[A.FileVersions]=h.FileVersions,Be[A.GetWopiInfoFromUrl]=h.GetWopiInfoFromUrl,Be[A.ModeSwitched]=h.ModeSwitched,Be[A.OpenInBrower]=h.OpenInBrowser,Be[A.OpenInClient]=h.OpenInClient,Be[A.RedeemForCommenting]=h.RedeemForCommenting,Be[A.RefreshSessionInfo]=h.RefreshSessionInfo,Be[A.ReplyWithChanges]=h.ReplyWithChanges,Be[A.ReportAbuse]=h.ReportAbuse,Be[A.SaveStatus]=h.SaveStatus,Be[A.Share]=h.Share,Be[A.ShareForm]=h.ShareForm,Be[A.SignIn]=h.SignIn,Be[A.UserAccessAndPermissions]=h.UserAccessAndPermissions,Be[A.UserActivity]=h.UserActivity,Be[A.UserEditActivity]=h.UserEditActivity,Be);!function(e){e.BrowserEvent="BrowserEvent",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl",e.ModeSwitched="ModeSwitched"}(ze||(ze={}));var Je=function(){function e(e,t,i,o,n){this.eventHandlers={},this.isIndividualRegistrationCalled=!1,this.isAllRegistrationCalled=!1,this.sessionId=e,this.logger=t,this.innerApplicationFrame=n.innerApplicationFrame,this.postMessenger=i,this.onDisposedCallback=o,this.registerPostMessageHandlers(),ce()}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return D()},e.prototype.GetSessionId=function(){return this.sessionId},e.prototype.RegisterEventHandler=function(e,t){if(this.isAllRegistrationCalled)throw new Error("RegisterEventHandler is not supposed to be called");this.isIndividualRegistrationCalled=!0,this.registerEventHandlerInternal(e,t)},e.prototype.RemoveEventHandler=function(e,t){if(this.isAllRegistrationCalled)throw new Error("RemoveEventHandler is not supposed to be called");switch(e){case ze.Unloaded:case ze.DocumentReboot:case ze.WopiInfoFromUrl:if(this.eventHandlers[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.RegisterAllEventsHandler=function(e){var t=this;if(this.isIndividualRegistrationCalled)throw new Error("RegisterAllEventsHandler is not supposed to be called");if(this.isAllRegistrationCalled)throw new Error("RegisterAllEventsHandler is supposed to be called only once");this.isAllRegistrationCalled=!0,Object.keys(Ve).forEach((function(i){t.registerEventHandlerInternal(i,(function(t){return e(Ve[i],t)}))}))},e.prototype.PostCommand=function(e,t){this.postMessenger.postMessageForCommand(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.Dispose=function(e,t){var i=this;pe(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete i.innerApplicationFrame,i.onDisposedCallback(),i.postMessenger.dispose(),i.raiseEvent(ze.Unloaded,{});for(var e=0,t=Object.keys(i.eventHandlers);e<t.length;e++){var o=t[e];delete i.eventHandlers[o]}}),t)},e.prototype.registerEventHandlerInternal=function(e,t){switch(e){case ze.Unloaded:case ze.DocumentReboot:case ze.WopiInfoFromUrl:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=t;break;default:this.postMessenger.registerMessagePayloadHandler(e,t)}},e.prototype.registerPostMessageHandlers=function(){this.postMessenger.registerMessagePayloadHandler(A.Reboot,this.handleDocumentRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(A.SoftReboot,this.handleSoftRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(A.GetWopiInfoFromUrl,this.handleWopiInfoFromUrlRequest.bind(this))},e.prototype.raiseEvent=function(e,t){var i=this.eventHandlers[e];if(i)try{i(t||{})}catch(e){this.logger.ULS.traceTag(594556387,z.WopiPendingApplication,r.Error,"Handler error: "+S(e))}},e.prototype.handleDocumentRebootMessage=function(e){e.previousSessionId=this.sessionId,this.raiseEvent(ze.DocumentReboot,e)},e.prototype.handleSoftRebootMessage=function(e){window.location.reload()},e.prototype.handleWopiInfoFromUrlRequest=function(e){this.raiseEvent(ze.WopiInfoFromUrl,e)},e}();var je,Ge=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.resources=[],o.coreResourcesToObserve=[],o.initResources(),o}return u(t,e),t.prototype.initResources=function(){var e;(e=[{domain:"excel",url:"Ewa"+this.debugSuffix+".js",localized:!1,type:"script"}]).push({domain:"excel",url:"Aacorlib"+this.minSuffix+".js",localized:!1,type:"script"}),e.push({domain:"excel",url:"CookieCompliance.js",localized:!1,type:"script"}),e.push({domain:"excel",url:"Ewa.Strings.Wac"+this.debugSuffix+".js",localized:!0,type:"script"}),e.push({domain:"excel",url:"EwrDefault.css",localized:!0,type:"css"}),e.push({domain:"excel",url:"excelframe.css",localized:!0,type:"css"}),e.push({domain:"excel",url:"gridRenderer"+this.minSuffix+".js",localized:!1,type:"script"}),this.featureManager&&this.featureManager.isFeatureEnabled(H.ExcelAdaptiveLayoutDownload)&&e.push({domain:"excel",url:"adaptiveLayout"+this.minSuffix+".js",localized:!1,type:"script"}),this.coreResourcesToObserve.push(this.bootstrapperPageName);for(var t=0,i=e;t<i.length;t++){var o=i[t],n=this.resourceHostUrl;this.coreResourcesToObserve.push(o.url),"/"!==n[n.length-1]&&(n+="/");var s="App_Scripts";"css"===o.type&&(s="Resources");var r="";o.localized&&(r="1033/"),n+="x/s/"+this.buildPrefix+"__layouts/"+s+"/"+r+o.url,this.resources.push(n)}},t}(function(){function e(e,t){this.resourceHostUrl=M(e),this.buildPrefix=function(){var e=D();0;if(!e)throw new Error("Build number not available");var t=e.split(".");if(4!==t.length)throw new Error("Build number has incorrect format");return t[0]+t[2]+t[3]}(),this.debugSuffix="",this.minSuffix=".min",this.resourceHint=function(){var e=Y();if(e===B.Firefox||e===B.IE)return"prefetch";return"preload"}(),this.bootstrapperPageName=j(e),this.featureManager=t}return e.prototype.preloadResources=function(e){for(var t=0,i=this.resources;t<i.length;t++){var o=i[t];this.preloadResource(o,e)}},e.prototype.preloadResource=function(e,t){var i=document.createElement("link");if(i.setAttribute("crossorigin","anonymous"),i.rel=this.resourceHint,i.href=e,t){i.addEventListener("error",(function(){t.ULS.traceTag(595719107,z.WopiPendingApplication,r.Error,"Resource failed to load: "+j(e))}))}i.setAttribute("as","script"),document.head.appendChild(i)},e}()),qe=function(){function e(){}return e.prototype.shouldPreload=function(e){return this.isExcelsUrl(e)},e.prototype.preload=function(t,i,o){var n=new Ge(t,o);e.tryObserveResourceTiming(n.coreResourcesToObserve,i),n.preloadResources(i)},e.prototype.isExcelsUrl=function(e){return e.indexOf("xlviewerinternal.aspx")>=0},e.tryObserveResourceTiming=function(e,t){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(function(){try{for(var i=0,o=window.performance.getEntriesByType("resource");i<o.length;i++){var n=o[i],s=j(n.name);if("about:blank"!==n.name&&-1===s.indexOf("RemoteUls.ashx")&&-1===s.indexOf("mhtml:file")&&-1!==e.indexOf(s)){var a=JSON.stringify(n);a=a.replace(new RegExp(n.name,"g"),s),t.ULS.traceTag(595736532,z.WopiPendingApplication,r.Info,a)}}window.performance.clearResourceTimings()}catch(e){t.ULS.traceTag(595732049,z.WopiPendingApplication,r.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(e))}}),{once:!0})},e}();!function(e){e[e.NotSupported=0]="NotSupported",e[e.SameDocOnly=1]="SameDocOnly",e[e.AnyDoc=2]="AnyDoc",e[e.OtherMode=4]="OtherMode"}(je||(je={})),i.d(t,"Application",(function(){return Ze})),i.d(t,"DocRebootSupportMode",(function(){return je})),i.d(t,"CommandIds",(function(){return T})),i.d(t,"EventIds",(function(){return h}));var Ze=new Ne((function(e,t,i,o,n){return new Je(e,t,i,o,n)}),{forceSingleStepBoot:!0,preloader:new qe})}});

